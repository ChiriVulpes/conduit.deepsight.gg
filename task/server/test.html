<style>
	:root {
		color-scheme: light dark;
	}
	</style>
	<script>
		// @ts-check
		if (!('serviceWorker' in navigator))
			throw new Error('Service Worker is not supported in this browser')
		
		;(async () => {
			const registration = await navigator.serviceWorker.register('out/index.js');
			const service = registration.active
			navigator.serviceWorker.addEventListener('message', event => {
				console.log('Received from server:', event.data)
			})
			
			service?.postMessage({ type: 'testFunction', data: 'This is client data' })
			
			const wsProtocol = self.location.protocol === 'https:' ? 'wss:' : 'ws:'
			const wsUrl = `${wsProtocol}//${self.location.host}`
			const socket = new WebSocket(wsUrl)
			
			socket.addEventListener('message', event => {
				try {
					// eslint-disable-next-line @typescript-eslint/no-unsafe-argument
					const message = /** @type {{ type?: string, data?: any }} */ (JSON.parse(event.data))
					// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment
					const { type, data } = typeof message === 'object' && message !== null ? message : {}
	
					switch (type) {
						case 'notify:ts':
							registration.update()
							break
					}
				}
				catch {
					console.warn('Unsupported devserver message:', event.data)
				}
			})
		})()
	</script>